# ç”¨äºæ„å»ºå’Œéƒ¨ç½² Astro ç«™ç‚¹åˆ° GitHub Pages çš„ç¤ºä¾‹å·¥ä½œæµ
name: Deploy to GitHub Pages

on:
  # åœ¨æ¨é€åˆ° `main` åˆ†æ”¯æ—¶è¿è¡Œ
  push:
    branches: [main]
  # å…è®¸æ‚¨ä» Actions é€‰é¡¹å¡æ‰‹åŠ¨è¿è¡Œæ­¤å·¥ä½œæµ
  workflow_dispatch:

# è®¾ç½® GITHUB_TOKEN çš„é»˜è®¤æƒé™ï¼Œä»¥å…è®¸éƒ¨ç½²åˆ° GitHub Pages
permissions:
  contents: read
  pages: write
  id-token: write

# åªå…è®¸åŒæ—¶è¿›è¡Œä¸€æ¬¡éƒ¨ç½²ï¼Œè·³è¿‡åœ¨è¿›è¡Œä¸­è¿è¡Œä¹‹é—´æ’é˜Ÿçš„è¿è¡Œã€‚
# ä½†æ˜¯ï¼Œä¸è¦å–æ¶ˆè¿›è¡Œä¸­çš„è¿è¡Œï¼Œå› ä¸ºæˆ‘ä»¬å¸Œæœ›å…è®¸è¿™äº›éƒ¨ç½²å®Œæˆã€‚
concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  build:
    name: Build
    runs-on: ubuntu-latest
    steps:
      - name: "â˜ï¸ Checkout repository"
        uses: actions/checkout@v4
      - name: "ğŸ Setup Bun"
        uses: oven-sh/setup-bun@v2
      - name: "ğŸ“¦ Install dependencies"
        run: bun install --frozen-lockfile
      - name: "ğŸš€ Build the project"
        # ç¡®ä¿æ‚¨çš„ astro.config.mjs ä¸­è®¾ç½®äº†æ­£ç¡®çš„ `site` å’Œ `base` é€‰é¡¹
        run: bun run build
      - name: "ğŸ“¤ Upload artifact"
        uses: actions/upload-pages-artifact@v3
        with:
          path: ./dist

  deploy:
    name: Deploy
    needs: build
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - name: "ğŸš€ Deploy to GitHub Pages"
        id: deployment
        uses: actions/deploy-pages@v4